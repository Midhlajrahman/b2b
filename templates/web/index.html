{% extends 'web/partials/base.html' %} {% load static %} 
{% block title %}
Home
{% endblock  %}
{% block content %}
<main>
  <!-- banner -->
  {% comment %} <section data-anim-wrap class="masthead -type-3 relative z-5" >
    <div data-anim-child="fade delay-1" class="masthead__bg bg-dark-3">
      <img src="{% static 'web/img/pages/destinations/DubaiFullImg.jpg' %}" alt="image">
    </div>
    <div class="container">
      <div class="row justify-center">
        <div class="col-xl-10">
          <div class="text-center">
            <h1 data-anim-child="slide-up delay-4" class="text-60 lg:text-40 md:text-30 text-white">Discover Your World</h1>
            <p data-anim-child="slide-up delay-5" class="text-white mt-5">Discover amzaing places at exclusive deals</p>
          </div>
        </div>
      </div>
    </div>
  </section> {% endcomment %}

  <section data-anim-wrap class="masthead -type-1 z-5">
    <div data-anim-child="fade" class="masthead__bg">
      <img src="#" alt="image" data-src="{% static 'web/img/pages/destinations/DubaiFullImg.jpg' %}" class="js-lazy">
    </div>

    <div class="container">
      <div class="row justify-center">
        <div class="col-auto">
          <div class="text-center">
            <h1 data-anim-child="slide-up delay-4" class="text-60 lg:text-40 md:text-30 text-white">Find Next Place To Visit</h1>
            <p data-anim-child="slide-up delay-5" class="text-white mt-6 md:mt-10">Discover amzaing places at exclusive deals</p>
          </div>

          <div data-anim-child="slide-up delay-6" class="tabs -underline mt-60 js-tabs">
            <div class="tabs__controls d-flex x-gap-30 y-gap-20 justify-center sm:justify-start js-tabs-controls">

            

            </div>

            <div class="tabs__content mt-30 md:mt-20 js-tabs-content">

              <div class="tabs__pane -tab-item-1 is-tab-el-active">

                <div class="mainSearch -w-900 bg-white px-10 py-10 lg:px-20 lg:pt-5 lg:pb-20 rounded-100">
                  <div class="button-grid items-center">

                    <div class="searchMenu-date px-30 lg:py-20 lg:px-0 js-form-dd js-calendar js-calendar-el">

                      <div data-x-dd-click="searchMenu-date">
                        <h4 class="text-15 fw-500 ls-2 lh-16">Enter your date</h4>

                        <div class="capitalize text-15 text-light-1 ls-2 lh-16">
                          <span class="js-first-date" data-date="Select Your Date">Select Your Date</span>
                 
                          
                       
                        </div>
                      </div>


                      <div class="searchMenu-date__field shadow-2" data-x-dd="searchMenu-date" data-x-dd-toggle="-is-active">
                        <div class="bg-white px-30 py-30 rounded-4">
                          <div class="elCalendar js-calendar-el-calendar"></div>
                        </div>
                      </div>
                    </div>


                    <div class="searchMenu-loc px-30 lg:py-20 lg:px-0 js-form-dd js-liverSearch">

                      <div data-x-dd-click="searchMenu-loc">
                        <h4 class="text-15 fw-500 ls-2 lh-16">Location</h4>

                        <div class="text-15 text-light-1 ls-2 lh-16">
                          <input autocomplete="off" type="search" placeholder="Where are you going?" class="js-search js-dd-focus" id="location-input" />
                        </div>
                      </div>


                      <div class="searchMenu-loc__field shadow-2 js-popup-window" data-x-dd="searchMenu-loc" data-x-dd-toggle="-is-active">
                        <div class="bg-white px-30 py-30 sm:px-0 sm:py-15 rounded-4">
                          <div class="y-gap-5 js-results">
                            {% for city in cities %}
                            
                         
                            <div>
                              <button class="-link d-block col-12 text-left rounded-4 px-20 py-15 js-search-option" data-city="{{ city.name }}" onclick="selectCity('{{ city.name }}')">
                                <div class="d-flex">
                                  <div class="icon-location-2 text-light-1 text-20 pt-4"></div>
                                  <div class="ml-10">
                                    <div class="text-15 lh-12 fw-500 js-search-option-target">{{city.name}}</div>
                                    <div class="text-14 lh-12 text-light-1 mt-5">{{city.name}}</div>
                                  </div>
                                </div>
                              </button>
                            </div>
                            {% endfor %}

                          </div>
                        </div>
                      </div>
                    </div>

                  

                    <div class="searchMenu-guests px-30 lg:py-20 lg:px-0 js-form-dd js-form-counters">

                      <div data-x-dd-click="searchMenu-guests">
                        <h4 class="text-15 fw-500 ls-2 lh-16">Guest</h4>

                        <div class="text-15 text-light-1 ls-2 lh-16">
                          <span class="js-count-adult">2</span> adults
                          -
                          <span class="js-count-child">1</span> childeren
                          -
                          <span class="js-count-room">1</span> room
                        </div>
                      </div>


                      <div class="searchMenu-guests__field shadow-2" data-x-dd="searchMenu-guests" data-x-dd-toggle="-is-active">
                        <div class="bg-white px-30 py-30 rounded-4">
                          <div class="row y-gap-10 justify-between items-center">
                            <div class="col-auto">
                              <div class="text-15 fw-500">Adults</div>
                            </div>

                            <div class="col-auto">
                              <div class="d-flex items-center js-counter" data-value-change=".js-count-adult">
                                <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-down">
                                  <i class="icon-minus text-12"></i>
                                </button>

                                <div class="flex-center size-20 ml-15 mr-15">
                                  <div class="text-15 js-count">2</div>
                                </div>

                                <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-up">
                                  <i class="icon-plus text-12"></i>
                                </button>
                              </div>
                            </div>
                          </div>

                          <div class="border-top-light mt-24 mb-24"></div>

                          <div class="row y-gap-10 justify-between items-center">
                            <div class="col-auto">
                              <div class="text-15 lh-12 fw-500">Children</div>
                              <div class="text-14 lh-12 text-light-1 mt-5">Ages 0 - 17</div>
                            </div>

                            <div class="col-auto">
                              <div class="d-flex items-center js-counter" data-value-change=".js-count-child">
                                <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-down">
                                  <i class="icon-minus text-12"></i>
                                </button>

                                <div class="flex-center size-20 ml-15 mr-15">
                                  <div class="text-15 js-count">1</div>
                                </div>

                                <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-up">
                                  <i class="icon-plus text-12"></i>
                                </button>
                              </div>
                            </div>
                          </div>

                          <div class="border-top-light mt-24 mb-24"></div>

                          <div class="row y-gap-10 justify-between items-center">
                            <div class="col-auto">
                              <div class="text-15 fw-500">Rooms</div>
                            </div>

                            <div class="col-auto">
                              <div class="d-flex items-center js-counter" data-value-change=".js-count-room">
                                <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-down">
                                  <i class="icon-minus text-12"></i>
                                </button>

                                <div class="flex-center size-20 ml-15 mr-15">
                                  <div class="text-15 js-count">1</div>
                                </div>

                                <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-up">
                                  <i class="icon-plus text-12"></i>
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>


                    <div class="button-item">
                      <button id="mainSearchButton" class="mainSearch__submit button -dark-1 h-60 px-35 col-12 rounded-100 bg-blue-1 text-white"
                      onclick="selectCityDate('Select City', 'Select Date')">
                        <i class="icon-search text-20 mr-10"></i>
                        Search
                      </button>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- banner end  -->
  <!-- popular Cities -->
  <section class="layout-pt-lg ">
    <div class="container">
      <div  class="row justify-center text-center">
        <div class="col-auto">
          <div class="sectionTitle -md">
            <h2 class="sectionTitle__title">Explore World's Top Destinations</h2>
            <p class=" sectionTitle__text mt-5 sm:mt-0">These popular Destinations have a lot to offer</p>
          </div>
        </div>
      </div>

      {% comment %} if render search details for html {% endcomment %}
      {% comment %} <div id="resultDiv" class="row y-gap-20 pt-30" style="display: none;">
        <div class="col-lg-4 col-md-6 col-sm-6">
            <div class="ctaCard -type-1 rounded-10">
                <div class="ctaCard__image ratio ratio-41:35">
                   
                    <img id="cityImage" class="img-ratio js-lazy" src="#" alt="City Image" style="display: none;">
                </div>
                <div class="ctaCard__content py-50 px-50 lg:py-30 lg:px-30">
                    <h4 class="text-26 lg:text-26 text-white" id="selectedCity">Things To Do in<br></h4>
                  
                    <div id="destinationImagesContainer" class="d-inline-block mt-15">
                      
                    </div>
                </div>
            </div>
        </div>
    </div> {% endcomment %}




      <div class="row y-gap-20 pt-30">
        {% for cities in city %}
        <div  class="col-lg-4 col-md-6 col-sm-6">
          <div class="ctaCard -type-1 rounded-10 ">
            <div class="ctaCard__image ratio ratio-41:35">
              <img class="img-ratio js-lazy" src="#" data-src="{{cities.image.url}}" alt="image">
            </div>
            <div class="ctaCard__content py-50 px-50 lg:py-30 lg:px-30">
              <h4 class="text-26 lg:text-26 text-white">Things To Do in<br>{{cities.name}} </h4>
              <div class="d-inline-block mt-15">
                <a href="{% url 'web:destination' cities.pk %}" class="button px-20 py-10 -blue-1 -min-150 bg-white text-dark-1">Explore</a>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>
  <!-- popular Cities end -->
  <!-- popular Tours -->

  <section class="layout-pt-md layout-pb-md">
    <div data-anim-wrap class="container">
      <div  class="row y-gap-20 justify-between items-end">
        <div class="col-auto">
          <div class="sectionTitle -md">
            <h2 class="sectionTitle__title">Most Popular Tours</h2>
            <p class=" sectionTitle__text mt-5 sm:mt-0 md:d-none">Uncover Our Most Loved Tours</p>
          </div>
        </div>

        <div class="col-auto">

          <div class="d-flex x-gap-15 items-center justify-center pt-40 sm:pt-20">
            <div class="col-auto">
              <button class="d-flex items-center text-24 arrow-left-hover js-places-prev">
                <i class="icon icon-arrow-left"></i>
              </button>
            </div>

            <div class="col-auto">
              <div class="pagination -dots text-border js-places-pag"></div>
            </div>

            <div class="col-auto">
              <button class="d-flex items-center text-24 arrow-right-hover js-places-next">
                <i class="icon icon-arrow-right"></i>
              </button>
            </div>
          </div>

        </div>
      </div>

      <div class="pt-20 pb-30  overflow-hidden js-section-slider " data-gap="20" data-slider-cols="xl-4 lg-3 md-2 sm-2 base-1" data-nav-prev="js-places-prev" data-pagination="js-places-pag" data-nav-next="js-places-next">
        <div class="swiper-wrapper">
          {% for destination in popular_destinations  %}
          <div data-anim-child="slide-left  " class="swiper-slide single-card">
            <div class="card-div">
              {% include 'web/partials/destination-card.html' %}
            </div>
          </div>
          {% endfor %}

        </div>
      </div>
    </div>
  </section>

  <!-- Why Choose Us end-->
  <!-- testimonial -->
  <section class="section-bg layout-pt-lg layout-pb-lg">
    <div class="section-bg__item -mx-20 bg-light-2"></div>

    <div data-anim-wrap class="container">
      <div  class="row justify-center text-center">
        <div class="col-auto">
          <div class="sectionTitle -md">
            <h2 class="sectionTitle__title">Millions Love Holidays with us</h2>
          </div>
        </div>
      </div>

      <div class="relative mt-40 md:mt-20 js-section-slider" data-gap="30" data-slider-cols="xl-3 lg-3 md-2 sm-1 base-1">
        <div class="swiper-wrapper">

          {% for i in testimonials %}
          <div data-anim-child="slide-up " class="swiper-slide">
            <div class="blogCard__image">
              <div class="ratio ratio-2:1 rounded-top-10">
                <img class="img-ratio js-lazy" src="#" data-src="{{ i.image.url }}" alt="image" style="max-height: 200px;" >
              </div>
            </div>
            <div class="testimonials -type-1 bg-white rounded-10 pt-20 pb-20 px-20">
              
              <div class="mb-28 ">
                
                <div class="row x-gap-20 y-gap-20 items-center">
                  
                  <div class="col-auto">
                    <div class="size-60 test-border" > <span>{{ i.full_name|first|capfirst }}</span> </div>
                  </div>

                  <div class="col-auto" style="width: 65%;">
                    <div class="text-15 fw-500 lh-14">{{i.full_name}}</div>
                    <div class="text-14 lh-14 text-light-1 mt-5">{{i.country}}</div>
                    <div class="d-flex items-center x-gap-5 mt-10">
                      {% for star in "12345" %}
                        {% if star|add:0 <= i.review_star_count %}
                        <div class="icon-star text-yellow-1 text-10"></div>
                        {% else %}
                        <div class="icon-star text-light-1 text-10"></div>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
              
              <p class="testimonials__text lh-18 fw-500 text-dark-1" style="font-size: 12px;">&quot;{{i.content}}.&quot;</p>
            </div>
          </div>
          {% endfor %}
        </div>


        <button class="section-slider-nav -prev flex-center button -blue-1 bg-white shadow-1 size-40 rounded-full sm:d-none js-prev">
          <i class="icon icon-chevron-left text-12"></i>
        </button>

        <button class="section-slider-nav -next flex-center button -blue-1 bg-white shadow-1 size-40 rounded-full sm:d-none js-next">
          <i class="icon icon-chevron-right text-12"></i>
        </button>

      </div>

     
    </div>
  </section>
 <!-- testimonial end-->
  <!-- Member -->
  {% if partner_logos %}
  <section class="pt-30 pb-30">
    <div class="container">
      <div class="row justify-center">
        <div class="owl-carousel">
          {% for i in partner_logos %}
          <div class="item">
            <img src="{{i.image.url}}" alt=""  width="150px">
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>
  {% endif %}
  <section class="pt-40 pb-40 bg-green-1">
    <div class="container">
      <div class="row y-gap-10 justify-between align-items-center">
        <div class="col-auto">
          <div class="sectionTitle -md">
            <h2 class="sectionTitle__title">Not a Member Yet?</h2>
            <p class="text-dark-1 sectionTitle__text mt-5 sm:mt-0">Join us! Our members can access savings of up to 50% and earn Trip Coins while booking.</p>
          </div>
        </div>
        <div class="col-auto">
          <div class="row x-gap-20 y-gap-20">
            <div class="col-auto">
              <a href="/accounts/login/"><button class="button px-30 h-50 -blue-1 text-blue-1 border-blue-1">
                Sign In
                <i class="icon-arrow-top-right ml-10"></i>
              </button></a>
            </div>

            <div class="col-auto">
              <a href="{% url 'registration_register' %}"><button class="button px-30 h-50 -blue-1 bg-yellow-1 text-dark-1">
                Register
                <i class="icon-arrow-top-right ml-10"></i>
              </button></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


  <!-- member end -->
</main>

{% endblock %}

{% block js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<script>
  $(document).ready(function(){
    $('.owl-carousel').owlCarousel({
      loop: true,
      margin: 10,
      nav: false,
      items: 5, // Adjust the number of items per row
      autoplay: true,
      autoplayTimeout: 2000,
    });
  });
</script>
<script>
  const citiesData = JSON.parse('{{ cities_data|escapejs }}');
</script>
{% comment %} <script>
  function selectCity(cityName) {
     var inputField = document.getElementById('location-input');
      inputField.value = cityName;

  }
  </script> {% endcomment %}

<script>
  function selectCityDate(cityName, availableDate) {
    const data = {
        city: cityName,
        date: availableDate
    };
    console.log(data);

    fetch('/check-availability/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken'),
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        if (data.available) {
            const url = `/search/?city=${encodeURIComponent(cityName)}&date=${encodeURIComponent(availableDate)}`;
            window.location.href = url;
            // Update the city name, date, and display city image
            document.getElementById('selectedCity').innerText = `Things To Do in ${cityName}`;
            document.getElementById('selectedDate').innerText = `Date: ${availableDate}`;
            document.getElementById('resultDiv').style.display = 'block';

            // Update city image
            const cityImage = document.getElementById('cityImage');
            cityImage.src = data.city_image;
            cityImage.style.display = 'block';

            // Update destination images
            const destinationImagesContainer = document.getElementById('destinationImagesContainer');
            destinationImagesContainer.innerHTML = ''; // Clear previous images
            data.destination_images.forEach(url => {
                const img = document.createElement('img');
                img.src = url;
                img.classList.add('img-ratio', 'js-lazy');
                destinationImagesContainer.appendChild(img);
            });

            // Scroll to the result div
            document.getElementById('resultDiv').scrollIntoView({ behavior: 'smooth' });
        } else {
            alert("Date and city are not available.");
            document.getElementById('resultDiv').style.display = 'none';
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}


// Function to get CSRF token (if needed)
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          // Check if this cookie string begins with the name we want
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
          }
      }
  }
  return cookieValue;
}
</script>
{% comment %} <script>
    // Function to update the main search button with selected city and date
function setCityDate(city, date) {
  const mainSearchButton = document.getElementById('mainSearchButton');
  
  // Check if both city and date are selected
  if (city !== 'Select City' && date !== 'Select Date') {
      mainSearchButton.setAttribute('onclick', `selectCityDate('${city}', '${date}')`);
  } else {
      mainSearchButton.setAttribute('onclick', `alert('Please select both a city and a date')`);
  }
 }
 
 // Event listener for selecting a city
 document.querySelectorAll('.js-search-option').forEach(button => {
  button.addEventListener('click', function() {
      const city = this.getAttribute('data-city');
      const date = document.querySelector('.js-first-date').getAttribute('data-date');
      console.log(date)
      setCityDate(city, date);
  });
 });
</script> {% endcomment %}


<script>
  function selectCity(cityName) {
    const inputField = document.getElementById('location-input');
    inputField.value = cityName;

    // Get the selected date or use the default text
    const selectedDate = document.querySelector('.js-first-date').getAttribute('data-date') || 'Select Date';
    
    // Update the search button with both city and date
    setCityDate(cityName, selectedDate);

    const cityDropdown = document.querySelector('.searchMenu-loc__field');
    cityDropdown.classList.remove('-is-active'); // if using classes
  }
  
  // Function to update the main search button with selected city and date
  function setCityDate(city, date) {
    const mainSearchButton = document.getElementById('mainSearchButton');
    
    if (city !== 'Select City' && date !== 'Select Date') {
      mainSearchButton.setAttribute('onclick', `selectCityDate('${city}', '${date}')`);
    } else {
      mainSearchButton.setAttribute('onclick', `alert('Please select both a city and a date')`);
    }
  }

  // Event listener for date selection
  $(document).ready(function() {
    $('.js-calendar-el-calendar').datepicker({
      dateFormat: 'yy-mm-dd',
      onSelect: function(dateText) {
        $('.js-first-date').each(function() {
          $(this).text(dateText);
          $(this).attr('data-date', dateText);
        });

        const selectedCity = document.getElementById('location-input').value || 'Select City';
        setCityDate(selectedCity, dateText);

        $('.js-calendar-el-calendar').datepicker("hide");

        
      }
    });

    // Event listener for city selection
    document.querySelectorAll('.js-search-option').forEach(button => {
      button.addEventListener('click', function() {
        const city = this.getAttribute('data-city');
        const date = document.querySelector('.js-first-date').getAttribute('data-date') || 'Select Date';
        setCityDate(city, date);
      });
    });
  });
</script>
{% endblock %}

{% block css %}
<style>
  .owl-carousel .owl-stage {
    display: flex;
    flex-wrap: wrap;
    transform: translate3d(0, 0, 0);
  }

  .owl-carousel .owl-item {
    width: 20%; 
    float: left;
  }

  .owl-carousel .owl-stage-outer {
    overflow: hidden;
  }

  .owl-carousel .owl-nav,.owl-dots {
    display: none;
  }
</style>
{% endblock %}



